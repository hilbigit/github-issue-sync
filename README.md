
# Introduction

![Publish](https://github.com/paritytech/github-issue-sync/actions/workflows/publish.yml/badge.svg?branch=master)

This project enables (deviating from the original forked action) syncing GitHub Issues to another Github repository within another organization.

## Why is this necessary?

Meanwhile there is an official Github - Workflow solving the problem which was originally solved by paitytech (see fork info - thanks to this contribution!). 

Nevertheless - 
# How it works
The following events trigger the synchronization of an issue:
- [`issues`](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#issues)
	- `opened`
	- `reopened`
	- `labeled`
- [`workflow_dispatch`](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch)

The action will sync any newly created or reopened issue

## Setup
To have the action working in your repository you need to create the file `.github/workflows/github-issue-sync.yml` in your repository with the following content.

The prerequisite is that a secret with the name DESTINATION_TOKEN is stored. Behind it there must be an access token with write permission to the above-mentioned repo and API permission.

In addition the placeholders <target_repo> and <target_org> must be exchanged. The name of  target repository the name of the organization owning this repository have to be entered.

Optionally, a list of labels can be created that trigger sync - in the example the label 'sync'.
Via the optional parameter
```
           SYNC_LABELS_DISABLED: "true"
```
you can prevent the labels from being transferred to the target project.

```yaml
name: GitHub Issue Sync

on:
  issues:
    types:
      - opened
      - labeled
  workflow_dispatch:
    inputs:
      excludeClosed:
        description: 'Exclude closed issues in the sync.'
        type: boolean 
        default: true

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync issues
        uses: hilbigit/github-issue-sync@forgejo
        with:
          # This token is autogenerated by GitHub
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
           DESTINATION_TOKEN: ${{ secrets.DESTINATION_TOKEN }}
          DESTINATION_ORG: "<target-org>"
          DESTINATION_REPO: "<target-repo>"
          # Uncomment this if labels shall not be copied to target project:
          # SYNC_LABELS_DISABLED: "true"


          # Parameter "labels" contains a list of labels which trigger the sync - 
          # this is independant from SYNC_LABELS_DISABLED - setting
          labels: |
            sync
            epic
```
You can generate a new token [in your user's token dashboard](https://github.com/settings/tokens/new).

### Caveats:
- Only the title, description/body and (if SYNC_LABELS_DISABLED is not "true" and the labels exist in the target project) labels are synchronized
- There is currently no way to sync comments and changes with existing issues - changing the on condition could trigger a new copy of the issue upon change, but this has not yet been tested as this could lead to uncontrolled copies. Therefore, see the following point rather than a “workaround”:
- If a label is removed and added again, the sync occurs again, meaning the issue is created twice
  - This can be used specifically to sync the issue again if it changes - the old version then has to be deleted manually in the target repo
 
  
### Warning about labels field
The labels field accepts an array or a single value, [but only with some particular format](https://github.com/actions/toolkit/issues/184#issuecomment-1198653452), so it is important to follow it.
It accepts either:
```yml
labels: my label name
```
or an array of labels using a `pipe`:
```yml
labels: |
  some label
  another label
  third label
```
It **does not** support the following type of arrays:
```yml
# not this one
labels:
  - some label
  - another one

# also doesn't support this one
labels: ["some label", "another one"]
```


## Development
To work on this app, you require
- `Node 18.x`
- `yarn`
Use `yarn install` to set up the project.
`yarn test` runs the unit tests.
`yarn build` compiles the TypeScript code to JavaScript.
